<head>
    <meta charset="UTF-8">
    <meta name='admaven-placement' content="Bqdr6rTgF">
    <script data-cfasync="false" src="//dcbbwymp1bhlf.cloudfront.net/?wbbcd=1116103"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analizador Profesional de URLs</title>

    <style>
        /* Reset y estilo general */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Arial', sans-serif;
        }

        /* Estilo de fondo y estructura del cuerpo */
        body {
            background-color: #121212;
            color: #ffffff;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            min-height: 100vh;
            background-image: url('https://media.istockphoto.com/id/1788319112/es/foto/tecnolog%C3%ADa-global-de-ia.webp?b=1&s=612x612&w=0&k=20&c=85wtbMGVsb0Ujjrrw-v6kxwLU2GBxVvj149-EppC_Zc=');
            background-size: cover;
            background-position: center;
            padding: 20px;
            overflow-y: auto;
        }

        /* T√≠tulo principal */
        h1 {
            font-size: 2.8rem;
            color: #ffffff;
            margin-bottom: 20px;
            text-align: center;
            font-weight: bold;
            letter-spacing: 1.5px;
            background: linear-gradient(90deg, #ff7e5f, #feb47b);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        /* Contenedor principal */
        .container {
            background-color: rgba(20, 20, 20, 0.9);
            width: 100%;
            max-width: 750px;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7);
            margin-top: 50px;
            display: flex;
            flex-direction: column;
            align-items: center;
            overflow-y: auto;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .container:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.9);
        }

        /* Campo de entrada de URL */
        .input-url {
            width: 100%;
            padding: 15px;
            margin: 15px 0;
            border-radius: 8px;
            border: 2px solid #555;
            background-color: #2c2c2c;
            color: #e0e0e0;
            font-size: 1rem;
            transition: border-color 0.3s ease, background-color 0.3s ease, box-shadow 0.3s ease;
        }

        .input-url:focus {
            border-color: #28a745;
            background-color: #333;
            box-shadow: 0 0 10px rgba(40, 167, 69, 0.5);
            outline: none;
        }

        /* Botones */
        .button {
            width: 100%;
            padding: 15px;
            margin-top: 12px;
            border-radius: 8px;
            border: none;
            background-color: #28a745;
            color: #ffffff;
            font-weight: bold;
            font-size: 1.1rem;
            cursor: pointer;
            transition: background-color 0.3s ease, transform 0.2s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 128, 0, 0.3);
        }

        .button:hover {
            background-color: #218838;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 128, 0, 0.4);
        }

        .button-danger {
            background-color: #dc3545;
            box-shadow: 0 4px 15px rgba(220, 53, 69, 0.3);
        }

        .button-danger:hover {
            background-color: #c82333;
            box-shadow: 0 6px 20px rgba(220, 53, 69, 0.4);
        }

        /* Direcci√≥n IP */
        .ip-address {
            font-family: 'Courier New', Courier, monospace;
            color: #ff4c4c;
            font-size: 1.8rem;
            text-shadow: 0 0 8px rgba(255, 76, 76, 0.8);
            margin-top: 10px;
        }

        /* Resultados */
        .result {
            width: 100%;
            margin-top: 20px;
            padding: 20px;
            background-color: #222;
            border-radius: 8px;
            font-size: 1rem;
            color: #e0e0e0;
            white-space: pre-wrap;
            overflow: auto;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.3);
        }

        .result:hover {
            background-color: #292929;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.4);
        }

        /* Alerta */
        .alerta {
            background-color: rgba(255, 0, 0, 0.85);
            padding: 15px;
            margin-top: 20px;
            border-radius: 8px;
            width: 100%;
            text-align: center;
            font-weight: bold;
            color: #ffffff;
        }

        /* Historial */
        .history {
            margin-top: 30px;
            width: 100%;
            max-height: 250px;
            overflow-y: auto;
            background-color: rgba(30, 30, 30, 0.9);
            padding: 15px;
            border-radius: 8px;
            box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.5);
        }

        .history-item {
            background-color: #333;
            padding: 12px;
            margin-bottom: 10px;
            border-radius: 8px;
            color: #dcdcdc;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }

        .history-item:hover {
            background-color: #3a3a3a;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }

        /* Responsivo */
        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }

            h1 {
                font-size: 2.2rem;
            }

            .input-url {
                padding: 12px;
            }

            .button {
                padding: 12px;
                font-size: 0.95rem;
            }

            .ip-address {
                font-size: 1.6rem;
            }
        }
    </style>
</head>

<body>

    <div class="alerta">
        ‚ö†Ô∏è <strong>Importante:</strong> Si actualizas la p√°gina, los resultados actuales del an√°lisis se perder√°n.
    </div>
    

    <div class="container">
        <!-- Encabezado Principal -->
        <header class="header">
            <h1 class="title">üîç Analizador De URLs</h1>
            <div id="ipAddress" class="ip-address">IP: Cargando...</div>
        </header>
    
        <!-- Secci√≥n de Entrada de URL -->
        <section class="input-section">
            <label for="urlInput" class="input-label">URL a analizar:</label>
            <input id="urlInput" type="text" class="input-url" placeholder="Ingresa la URL para analizar...">
            <div class="button-group">
                <button class="button analyze-button" onclick="analizarURL()">üîç Analizar URL</button>
                <button class="button clear-button" onclick="limpiarFormulario()">üßπ Limpiar</button>
            </div>
        </section>
    
        <!-- Secci√≥n de Alerta (opcional, solo visible en ciertas situaciones) -->
        <div class="alerta" id="alerta" style="display: none;">
            ‚ö†Ô∏è <strong>Atenci√≥n:</strong> Si actualizas la p√°gina, se perder√°n los resultados actuales del an√°lisis.
        </div>
    
        <!-- Resultados del An√°lisis -->
        <section id="result" class="result">
            <h2 class="result-title">üìä Resultado del An√°lisis</h2>
            <div class="result-content">Los resultados del an√°lisis aparecer√°n aqu√≠...</div>
        </section>
    
        <!-- Bot√≥n de Descarga -->
        <div class="actions">
            <button class="button download-button" onclick="descargarResultado()">üì• Descargar Informe</button>
        </div>
    
        <!-- Secci√≥n de Historial -->
        <section class="history-section">
            <h3 class="history-title">üïò Historial de An√°lisis</h3>
            <div id="history" class="history-list">No hay an√°lisis previos.</div>
        </section>
    </div>
    
    <script>
        // Funciones de an√°lisis adicionales
        const analisisFunciones = [
            // An√°lisis existentes
            function validarEstructuraURL(url) {
    const regex = /^(https?:\/\/)?([a-z\d-]+(\.[a-z\d-]+)+)(:[\d]{1,5})?(\/[\w\.-]*)*\/?$/i;
    
    if (!url) return "‚ùå Error: No se proporcion√≥ una URL.";

    return regex.test(url)
        ? "‚úîÔ∏è La estructura de la URL es v√°lida."
        : "‚ùå La estructura de la URL no es v√°lida. Verifica que el formato sea correcto, como: 'https://www.ejemplo.com'";
},

async function detectarHTTPS(url) {
    // Validaci√≥n de la URL (garantizar que la entrada sea una cadena y que sea v√°lida)
    if (!url || typeof url !== 'string') {
        return "‚ùå Error: No se proporcion√≥ una URL v√°lida.";
    }

    // Verificar si la URL est√° correctamente formateada
    try {
        const urlObj = new URL(url);  // Si la URL es malformada, se lanza un error
    } catch (e) {
        return "‚ùå Error: La URL proporcionada no es v√°lida.";
    }

    // Verificar si la URL usa HTTPS con expresi√≥n regular
    const regex = /^https:\/\//i;
    if (!regex.test(url)) {
        return "‚ùå La URL no usa HTTPS. üõë Esto podr√≠a exponer tus datos a ataques. Es recomendable usar HTTPS.";
    }

    // Verificaci√≥n del certificado SSL del sitio (requiere consulta asincr√≥nica)
    try {
        const isSecure = await verificarCertificadoSSL(url);
        if (isSecure) {
            return "‚úîÔ∏è La URL usa HTTPS y tiene un certificado SSL v√°lido. Es segura.";
        } else {
            return "‚ö†Ô∏è La URL usa HTTPS pero el certificado SSL no es v√°lido. Esto podr√≠a comprometer la seguridad.";
        }
    } catch (e) {
        return "‚ùå No se pudo verificar el certificado SSL de la URL.";
    }
},

// Funci√≥n para verificar si la URL tiene un certificado SSL v√°lido (requiere API externa)
async function verificarCertificadoSSL(url) {
    const domain = new URL(url).hostname;

    try {
        // Usamos una API externa como SSL Labs (ejemplo) para obtener informaci√≥n sobre el certificado
        const apiUrl = `https://api.ssllabs.com/api/v3/analyze?host=${domain}`;
        const response = await fetch(apiUrl);
        const data = await response.json();

        // Comprobamos si el certificado SSL est√° presente y es v√°lido
        if (data && data.endpoints && data.endpoints[0] && data.endpoints[0].status === "READY") {
            return data.endpoints[0].grade !== "F";  // Si la calificaci√≥n del certificado no es "F", es seguro
        } else {
            return false;  // Si no se puede verificar el SSL o est√° en proceso, lo consideramos inseguro
        }
    } catch (e) {
        console.error("Error al verificar el certificado SSL:", e);
        return false;  // Si la API falla, consideramos que el certificado no es v√°lido
    }
},


function verificarParametros(url) {
    try {
        // Verificar si la URL es v√°lida y si el protocolo es http o https
        const urlObj = new URL(url);
        if (!['http:', 'https:'].includes(urlObj.protocol)) {
            return "‚ùå La URL no utiliza un protocolo seguro (HTTP/HTTPS).";
        }

        const params = urlObj.searchParams;
        let resultado = "Par√°metros en la URL:\n";
        
        if ([...params].length === 0) {
            resultado += "‚úîÔ∏è La URL no contiene par√°metros.";
        } else {
            params.forEach((value, key) => {
                // Aseguramos que las claves y valores sean seguros antes de mostrarlos
                if (key && value) {
                    resultado += `${key} = ${value}\n`;
                }
            });
        }
        
        return resultado;
    } catch (error) {
        return "‚ùå URL no v√°lida para verificar par√°metros. Verifica que el formato sea correcto.";
    }
},

function extraerDominio(url) {
    // Verificar si la URL es una cadena no vac√≠a
    if (typeof url !== 'string' || url.trim() === '') {
        return null; // Entrada no v√°lida
    }

    // Intentar crear un objeto URL y extraer el dominio
    try {
        const urlObj = new URL(url);

        // Asegurarse de que la URL tenga un protocolo v√°lido (http, https, etc.)
        if (!urlObj.protocol || !urlObj.hostname) {
            return null; // Si no tiene protocolo o dominio, la URL es inv√°lida
        }

        // Retornar el dominio de la URL (sin el protocolo)
        return urlObj.hostname;
    } catch (e) {
        return null; // URL malformada o no v√°lida
    }
},


// Funci√≥n mejorada para verificar el subdominio con validaci√≥n de patrones sospechosos
function verificarSubdominio(url) {
    // Verificar que la URL sea v√°lida
    const dominio = extraerDominio(url);
    if (!dominio) {
        return "‚ùå URL no v√°lida para verificar el subdominio.";
    }

    // Dividir el dominio en partes (subdominio, dominio principal, TLD)
    const partes = dominio.split(".");

    // Validar si la URL tiene al menos tres partes, lo que indica que podr√≠a haber un subdominio
    if (partes.length > 2) {
        const subdominio = partes[0];

        // Comprobar si el subdominio tiene una longitud inusual (m√°s de 5 caracteres)
        if (subdominio.length > 5) {
            return `‚ö†Ô∏è Subdominio largo o sospechoso detectado: ${subdominio}`;
        }

        // Lista de marcas conocidas (puedes ampliar esta lista)
        const listaNegraSubdominios = new Set([
            "paypal", "microsoft", "google", "amazon", "apple", "facebook", "twitter"
        ]);

        // Comprobaci√≥n de subdominio con patrones sospechosos de marcas
        if ([...listaNegraSubdominios].some(sub => subdominio.toLowerCase().includes(sub))) {
            return `‚ö†Ô∏è Subdominio sospechoso que imita una marca conocida: ${subdominio}`;
        }

        // Otras verificaciones personalizadas pueden ser a√±adidas aqu√≠, como patrones de phishing
    }

    // Si no se encuentran problemas, el subdominio parece seguro
    return "‚úîÔ∏è Subdominio parece seguro.";
},


// Funci√≥n mejorada para detectar URLs acortadas con verificaci√≥n en listas negras
function verificarSubdominio(url) {
    // Verificar que la URL sea v√°lida
    const dominio = extraerDominio(url);
    if (!dominio) {
        return "‚ùå URL no v√°lida para verificar el subdominio.";
    }

    // Validaci√≥n avanzada para detectar subdominios maliciosos usando expresiones regulares
    const regexMaliciosos = /(\d{1,3}\.){3}\d{1,3}|\%|\+|\&|\=|\.exe|\.js|\.com\.ru|\.cn|\.xyz|\.top/;
    if (regexMaliciosos.test(dominio)) {
        return "‚ö†Ô∏è Dominio o subdominio con patrones sospechosos detectados.";
    }

    // Dividir el dominio en partes (subdominio, dominio principal, TLD)
    const partes = dominio.split(".");
    const subdominio = partes.length > 2 ? partes[0] : null;

    // Si no hay subdominio o la URL tiene una estructura inusual
    if (!subdominio) {
        return "‚úîÔ∏è No se detect√≥ un subdominio, el dominio parece seguro.";
    }

    // Verificar la longitud del subdominio (m√°s de 5 caracteres puede ser sospechoso)
    if (subdominio.length > 5) {
        return `‚ö†Ô∏è Subdominio largo o sospechoso detectado: ${subdominio}`;
    }

    // Lista negra de subdominios comunes de phishing o suplantaci√≥n de identidad
    const listaNegraSubdominios = new Set([
        "paypal", "microsoft", "google", "amazon", "apple", "facebook", "twitter", "bank", "secure"
    ]);

    // Comprobaci√≥n de subdominio con marcas conocidas (realiza b√∫squeda m√°s flexible)
    if ([...listaNegraSubdominios].some(blacklist => subdominio.toLowerCase().includes(blacklist))) {
        return `‚ö†Ô∏è Subdominio sospechoso que imita una marca conocida: ${subdominio}`;
    }

    // Verificaci√≥n de patrones de phishing que podr√≠an tener subdominios con letras extra√±as o combinaciones enga√±osas
    const patronesPhishing = /(\w{1,3}\d{1,3})|([a-zA-Z]{2,3}\d{3,})/;
    if (patronesPhishing.test(subdominio)) {
        return "‚ö†Ô∏è Subdominio con patr√≥n sospechoso detectado (posible intento de phishing).";
    }

    // Confirmaci√≥n de que el subdominio parece seguro
    return "‚úîÔ∏è Subdominio parece seguro.";
},


// Funci√≥n de ejemplo que puede usar una API externa para verificar URLs maliciosas
async function verificarMalicious(url) {
    const apiUrl = `https://safebrowsing.googleapis.com/v4/threatMatches:find?key=YOUR_API_KEY`;
    const body = {
        client: {
            clientId: "your-client-id",
            clientVersion: "1.0"
        },
        threatInfo: {
            threatTypes: ["MALWARE", "SOCIAL_ENGINEERING", "UNWANTED_SOFTWARE", "POTENTIALLY_HARMFUL_APPLICATION"],
            platformTypes: ["ANY_PLATFORM"],
            urlInfo: {
                url: url
            }
        }
    };

    try {
        const response = await fetch(apiUrl, {
            method: "POST",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(body)
        });
        const data = await response.json();
        return data.matches && data.matches.length > 0;
    } catch (error) {
        console.error("Error al verificar la URL:", error);
        return false;
    }
},

            function detectarURLAcortada(url) {
                return (url.includes("bit.ly") || url.includes("t.co") || url.includes("tinyurl")) ? "‚ö†Ô∏è La URL parece estar acortada." : "‚úîÔ∏è La URL no est√° acortada.";
            },

            // Nuevos an√°lisis:
            function verificarCaracteresEspeciales(url) {
                const regex = /[!@#\$%\^\&*\)\(+=._-]+/;
                return regex.test(url) ? "‚ö†Ô∏è La URL contiene caracteres especiales." : "‚úîÔ∏è La URL no contiene caracteres especiales.";
            },
            function verificarLongitudURL(url) {
                return url.length < 2083 ? "‚úîÔ∏è Longitud de la URL dentro del rango permitido." : "‚ö†Ô∏è Longitud de la URL excesiva.";
            },
            function verificarExistenciaURL(url) {
                try {
                    const request = new XMLHttpRequest();
                    request.open('HEAD', url, false);
                    request.send();
                    return request.status === 200 ? "‚úîÔ∏è La URL responde correctamente." : "‚ö†Ô∏è La URL no responde correctamente.";
                } catch (e) {
                    return "‚ùå No se pudo comprobar la URL.";
                }
            },
            function detectarDominioPeligroso(url) {
                const dominiosPeligrosos = ["example.com", "phishing.com", "malicious.com"]; // Lista de ejemplo
                const dominio = extraerDominio(url);
                return dominiosPeligrosos.includes(dominio) ? "‚ö†Ô∏è Dominio peligroso detectado." : "‚úîÔ∏è Dominio seguro.";
            },
            function verificarSubrutasSospechosas(url) {
                const subrutasSospechosas = ["/admin", "/config", "/login"];
                const urlObj = new URL(url);
                const path = urlObj.pathname;
                for (const subruta of subrutasSospechosas) {
                    if (path.includes(subruta)) {
                        return `‚ö†Ô∏è Subruta sospechosa detectada: ${subruta}`;
                    }
                }
                return "‚úîÔ∏è No se detectaron subrutas sospechosas.";
            },
            function detectarURLConEncriptacion(url) {
                return url.includes("?token=") || url.includes("?key=") ? "‚ö†Ô∏è La URL contiene par√°metros encriptados." : "‚úîÔ∏è La URL no contiene encriptaci√≥n visible.";
            },
            function analizarCaracteresNoASCII(url) {
                const regex = /[^\x00-\x7F]/;
                return regex.test(url) ? "‚ö†Ô∏è La URL contiene caracteres no ASCII." : "‚úîÔ∏è La URL no contiene caracteres no est√°ndar.";
            },
            function verificarAccesibilidadSitio(url) {
                return url.includes("404") ? "‚ö†Ô∏è La URL redirige a una p√°gina no encontrada." : "‚úîÔ∏è La URL parece accesible.";
            },
            function detectarScriptsPotencialmentePeligrosos(url) {
                return url.includes("javascript:") ? "‚ö†Ô∏è La URL contiene un script potencialmente peligroso." : "‚úîÔ∏è No se detectaron scripts peligrosos.";
            },
            function verificarRedesSociales(url) {
                const redesSociales = ["facebook.com", "twitter.com", "instagram.com", "linkedin.com"];
                const dominio = extraerDominio(url);
                return redesSociales.some(red => dominio.includes(red)) ? "‚ö†Ô∏è La URL pertenece a una red social." : "‚úîÔ∏è La URL no pertenece a una red social.";
            },

            // Nuevas funciones:
            function verificarCodigoEstadoHTTP(url) {
                try {
                    const request = new XMLHttpRequest();
                    request.open('GET', url, false);
                    request.send();
                    return request.status === 200 ? "‚úîÔ∏è Respuesta HTTP 200 (OK)." : `‚ö†Ô∏è C√≥digo de estado HTTP: ${request.status}`;
                } catch (e) {
                    return "‚ùå Error al verificar c√≥digo de estado.";
                }
            },
            function verificarRedireccionHTTPS(url) {
                const httpUrl = url.replace(/^http:\/\//, 'https://');
                return httpUrl === url ? "‚úîÔ∏è La URL no requiere redirecci√≥n a HTTPS." : "‚ö†Ô∏è La URL redirige a HTTPS.";
            },
            function verificarMetaTags(url) {
                return fetch(url)
                    .then(response => response.text())
                    .then(text => {
                        return text.includes('<meta name="description"') ? "‚úîÔ∏è Meta descripci√≥n encontrada." : "‚ö†Ô∏è Meta descripci√≥n no encontrada.";
                    });
            },
            function verificarHeaderSeguridad(url) {
                return fetch(url, { method: 'HEAD' })
                    .then(response => {
                        const headers = response.headers;
                        return headers.has('X-Content-Type-Options') ? "‚úîÔ∏è Header de seguridad encontrado (X-Content-Type-Options)." : "‚ö†Ô∏è Header de seguridad no encontrado.";
                    });
            },
            function verificarCORS(url) {
                return fetch(url, { method: 'HEAD' })
                    .then(response => {
                        return response.headers.has('Access-Control-Allow-Origin') ? "‚úîÔ∏è CORS habilitado." : "‚ö†Ô∏è CORS no habilitado.";
                    });
            }
        ];

        async function analizarURL() {
            const url = document.getElementById('urlInput').value.trim();
            let resultados = "";

            for (const func of analisisFunciones) {
                resultados += await func(url) + "\n";
                document.getElementById('result').innerText = resultados;
                await new Promise(resolve => setTimeout(resolve, 2000)); // Pausa de 3 segundos entre an√°lisis
            }

            obtenerIP(url);
            actualizarHistorial(url, resultados);
        }

        // Funci√≥n para extraer el dominio de la URL
        function extraerDominio(url) {
    try {
        // Asegurarse de que la URL tenga el protocolo adecuado
        if (!/^https?:\/\//i.test(url)) {
            url = "https://" + url; // Si no tiene protocolo, agregar https por defecto
        }

        // Crear un objeto URL para analizar la URL
        const urlObj = new URL(url);

        // Obtener el dominio completo (con subdominio si existe)
        const dominioCompleto = urlObj.hostname;

        // Verificar si el dominio es v√°lido
        if (!dominioCompleto) {
            throw new Error("Dominio no encontrado.");
        }

        // Expresi√≥n regular para extraer dominio y subdominio (si existe)
        const regex = /^([a-zA-Z0-9-]+\.)*([a-zA-Z0-9-]+\.[a-zA-Z]{2,})(:[0-9]+)?$/;

        const match = dominioCompleto.match(regex);

        // Si el dominio es v√°lido y coincide con la expresi√≥n regular, devolver el dominio
        if (match) {
            const subdominio = match[1] ? match[1].slice(0, -1) : null; // El subdominio est√° en el grupo 1
            const dominioPrincipal = match[2]; // El dominio principal est√° en el grupo 2
            const tld = dominioPrincipal.split('.').pop(); // El TLD es la √∫ltima parte del dominio principal

            return {
                subdominio: subdominio || "No tiene subdominio",
                dominioPrincipal,
                tld,
                dominioCompleto
            };
        } else {
            throw new Error("Dominio no v√°lido.");
        }

    } catch (e) {
        return `‚ùå Error: ${e.message}`;
    }
}

        // Obtener la IP de la URL
        function obtenerIP(url) {
    try {
        // Validaci√≥n de la URL antes de extraer el dominio
        const dominio = extraerDominio(url);
        if (!dominio) {
            throw new Error('Dominio no v√°lido');
        }

        // Mostrar mensaje de carga mientras se realiza la solicitud
        document.getElementById('ipAddress').innerText = "Cargando IP...";

        // Solicitar la IP a la API utilizando HTTPS
        fetch(`https://ip-api.com/json/${dominio}?fields=query,city,country`)
            .then(response => {
                if (!response.ok) {
                    throw new Error('Error en la respuesta de la API');
                }
                return response.json();
            })
            .then(data => {
                if (data && data.query) {
                    const ip = data.query;
                    const ciudad = data.city || 'Desconocida';
                    const pais = data.country || 'Desconocido';
                    // Mostrar la IP y la ubicaci√≥n de manera profesional
                    document.getElementById('ipAddress').innerText = `IP: ${ip} (Ubicaci√≥n: ${ciudad}, ${pais})`;
                } else {
                    document.getElementById('ipAddress').innerText = "IP no encontrada o inv√°lida.";
                }
            })
            .catch(error => {
                console.error('Error al obtener IP:', error);
                document.getElementById('ipAddress').innerText = `‚ùå Error al obtener IP: ${error.message}`;
            });
    } catch (error) {
        console.error('Error en la extracci√≥n del dominio:', error);
        document.getElementById('ipAddress').innerText = "‚ùå URL no v√°lida para obtener la IP.";
    }
}


        // Limpiar formulario
        function limpiarFormulario() {
    // Comprobamos que los elementos existen antes de interactuar con ellos
    const urlInput = document.getElementById('urlInput');
    const result = document.getElementById('result');
    const ipAddress = document.getElementById('ipAddress');
    
    // Verificar si los elementos del DOM son v√°lidos antes de actualizarlos
    if (urlInput && result && ipAddress) {
        // Limpiar los valores de los campos
        urlInput.value = '';  // Limpiar campo de URL
        result.innerText = 'Los resultados del an√°lisis aparecer√°n aqu√≠...';  // Restablecer resultados al valor inicial
        ipAddress.innerText = 'IP: Cargando...';  // Restablecer el texto de IP al valor predeterminado
    } else {
        console.error("Uno o m√°s elementos no se han encontrado en el DOM.");
    }
}


        // Descargar los resultados
        function descargarResultado() {
    const contenido = document.getElementById('result').innerText.trim();

    // Verificar si hay contenido para descargar
    if (!contenido) {
        return; // Si no hay contenido, no hacemos nada
    }

    // Crear un Blob con el contenido
    const blob = new Blob([contenido], { type: 'text/plain' });

    // Crear un enlace para descargar el archivo
    const link = document.createElement('a');
    link.href = URL.createObjectURL(blob);
    link.download = 'resultado_analisis.txt';

    // Iniciar la descarga
    link.click();

    // Liberar el objeto URL creado
    URL.revokeObjectURL(link.href);
}


        // Actualizar historial
        function actualizarHistorial(url, resultados) {
    // Validar que los par√°metros sean correctos
    if (!url || !resultados) {
        console.warn('URL o resultados no proporcionados.');
        return; // Evitar actualizaci√≥n si no hay informaci√≥n suficiente
    }

    // Evitar que las URLs o resultados contengan contenido malicioso
    const urlValida = validarURL(url);
    if (!urlValida) {
        console.warn('URL maliciosa detectada, no se a√±adir√° al historial.');
        return; // Si la URL no es v√°lida, detener el proceso
    }

    const historyDiv = document.getElementById('history');

    // Evitar la inserci√≥n de elementos duplicados
    const historialExistente = Array.from(historyDiv.children);
    if (historialExistente.some(item => item.textContent.includes(url))) {
        console.log('Esta URL ya est√° en el historial.');
        return;
    }

    // Crear un nuevo elemento del historial de manera segura
    const nuevoElemento = document.createElement('div');
    nuevoElemento.classList.add('history-item');

    // Formatear la fecha de manera m√°s legible
    const fecha = new Date().toLocaleString();

    // Sanitizar los resultados antes de mostrarlos (evitar HTML, usar solo texto)
    const resultadosSanitizados = sanitizeText(resultados);

    // Crear el contenido con datos seguros
    nuevoElemento.innerHTML = `
        <strong>URL:</strong> ${escapeHTML(url)} <br>
        <strong>Fecha:</strong> ${fecha} <br>
        <strong>Resultados:</strong> ${resultadosSanitizados.slice(0, 100)}... <br> 
    `;

    // A√±adir el nuevo elemento al historial
    historyDiv.appendChild(nuevoElemento);

    // Guardar en localStorage de forma segura
    guardarHistorialEnStorage(url, fecha, resultados);
}

// Funci√≥n para validar URL (evitar inyecciones maliciosas)
function validarURL(url) {
    try {
        // Usar URL API para comprobar si la URL es v√°lida
        new URL(url);
        return true;
    } catch (e) {
        return false; // URL inv√°lida
    }
}

// Funci√≥n para sanitizar texto y evitar inserciones maliciosas (XSS)
function sanitizeText(texto) {
    return texto.replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/&/g, '&amp;');
}

// Funci√≥n para escapar texto HTML antes de mostrarlo en la p√°gina
function escapeHTML(texto) {
    return texto.replace(/[&<>"']/g, function (match) {
        const map = {
            '&': '&amp;',
            '<': '&lt;',
            '>': '&gt;',
            '"': '&quot;',
            "'": '&#39;',
        };
        return map[match];
    });
}

// Funci√≥n para guardar el historial en el almacenamiento local (con datos escapados y sanitizados)
function actualizarHistorial(url, resultados) {
    if (!url || !resultados) {
        console.warn('URL o resultados no proporcionados.');
        return; // Evitar la actualizaci√≥n si no hay informaci√≥n suficiente
    }

    const historyDiv = document.getElementById('history');

    // Verificar si la URL ya est√° en el historial para evitar duplicados
    const historialExistente = Array.from(historyDiv.children);
    if (historialExistente.some(item => item.textContent.includes(url))) {
        console.log('Esta URL ya est√° en el historial.');
        return; // Si ya existe, no agregarla nuevamente
    }

    // Crear un nuevo elemento del historial
    const nuevoElemento = document.createElement('div');
    nuevoElemento.classList.add('history-item');

    // Formatear la fecha de manera m√°s legible
    const fecha = new Date().toLocaleString();

    // A√±adir la URL y la fecha de an√°lisis
    nuevoElemento.innerHTML = `
        <strong>URL:</strong> ${url} <br>
        <strong>Fecha:</strong> ${fecha} <br>
        <strong>Resultados:</strong> ${resultados.slice(0, 100)}... <br> 
    `; // Solo mostrar los primeros 100 caracteres de los resultados

    // A√±adir el nuevo elemento al historial
    historyDiv.appendChild(nuevoElemento);

    // Guardar en el localStorage para persistencia (opcional)
    guardarHistorialEnStorage(url, fecha, resultados);
}

function guardarHistorialEnStorage(url, fecha, resultados) {
    // Recuperar historial almacenado (si existe)
    const historialGuardado = JSON.parse(localStorage.getItem('historial')) || [];

    // Agregar el nuevo an√°lisis al historial
    historialGuardado.push({ url, fecha, resultados });

    // Limitar la cantidad de elementos guardados (opcional)
    if (historialGuardado.length > 10) {
        historialGuardado.shift(); // Eliminar el an√°lisis m√°s antiguo si supera el l√≠mite
    }

    // Guardar de nuevo en localStorage
    localStorage.setItem('historial', JSON.stringify(historialGuardado));
}

</script>

</body>
</html>
